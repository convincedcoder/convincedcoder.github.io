<!DOCTYPE html>
<html>
  <head>
        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Writing an equals method - how hard can it be? | Convinced Coder</title>
<meta property="og:title" content="Writing an equals method - how hard can it be?" />
<meta name="author" content="Maarten Michiels" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you’ve ever had to write or test an equals method, you may have gotten a feel for how complex this can get. This post will explain a number of things that can go wrong, offer solutions, and explain how a library called EqualsVerifier can help you prevent unexpected behavior regarding object equality testing." />
<meta property="og:description" content="If you’ve ever had to write or test an equals method, you may have gotten a feel for how complex this can get. This post will explain a number of things that can go wrong, offer solutions, and explain how a library called EqualsVerifier can help you prevent unexpected behavior regarding object equality testing." />
<link rel="canonical" href="https://convincedcoder.com/2018/01/21/Writing-an-equals-method/" />
<meta property="og:url" content="https://convincedcoder.com/2018/01/21/Writing-an-equals-method/" />
<meta property="og:site_name" content="Convinced Coder" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-21T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@convincedcoder" />
<meta name="twitter:creator" content="@convincedcoder" />
<script type="application/ld+json">
{"name":null,"description":"If you’ve ever had to write or test an equals method, you may have gotten a feel for how complex this can get. This post will explain a number of things that can go wrong, offer solutions, and explain how a library called EqualsVerifier can help you prevent unexpected behavior regarding object equality testing.","author":{"@type":"Person","name":"Maarten Michiels"},"@type":"BlogPosting","url":"https://convincedcoder.com/2018/01/21/Writing-an-equals-method/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://convincedcoder.com/images/convincedcoder.png"},"name":"Maarten Michiels"},"image":null,"headline":"Writing an equals method - how hard can it be?","dateModified":"2018-01-21T00:00:00+01:00","datePublished":"2018-01-21T00:00:00+01:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"https://convincedcoder.com/2018/01/21/Writing-an-equals-method/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
		<link rel="alternate" type="application/rss+xml" title="Convinced Coder - A blog about general software development, Java and JavaScript" href="/feed.xml" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="theme-color" content="#ffffff">

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
	<!-- using Ryan Fait's sticky footer to stick the footer at the bottom of the page or content, whichever is lower -->
	
	<div class="sticky-footer-wrapper">
		<div class="wrapper-masthead">
		  <div class="container">
			<header class="masthead clearfix">
			  <a href="/" class="site-avatar"><img src="/images/convincedcoder.png" /></a>

			  <div class="site-info">
				<h1 class="site-name"><a href="/">Convinced Coder</a></h1>
				<p class="site-description">A blog about general software development, Java and JavaScript</p>
			  </div>

			  <nav>
				<a href="/">Blog</a>
				<a href="/about">About</a>
			  </nav>
			</header>
		  </div>
		</div>

		<div id="notice" class="container" style="background: #d28445; padding: 1em; border-radius: 0.5em; color: white;">
			<p>This blog is no longer being maintained. Most of the content has been migrated to the new website at <a href="https://learning-notes.mistermicheels.com" style="color: inherit; font-weight: bold;">learning-notes.mistermicheels.com</a>.</p>
			
			
				<p>New version of this post: <a href="https://learning-notes.mistermicheels.com/java/equals/" style="color: inherit; font-weight: bold;">Equals (Java)</a>.</p>
			
		</div>

		<div id="main" role="main" class="container">
		  <article class="post">
    <h1>Writing an equals method - how hard can it be?</h1>
    
    <div class="date">
        2018-01-21
    </div>

    <div class=post-tags>
               
                 
            <a href="/tag/java" class="tag">java</a>
        
    </div>

    <div class="entry">
        <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#why-override-the-default-equals-method-anyway">Why override the default equals method anyway?</a></li>
<li class="toc-entry toc-h2"><a href="#the-requirements-for-a-good-equals-method">The requirements for a good equals method</a></li>
<li class="toc-entry toc-h2"><a href="#introducing-the-point-class">Introducing the Point class</a></li>
<li class="toc-entry toc-h2"><a href="#the-journey-to-a-perfect-equals-method">The journey to a “perfect” equals method</a>
<ul>
<li class="toc-entry toc-h3"><a href="#attempt-1">Attempt #1</a>
<ul>
<li class="toc-entry toc-h4"><a href="#short-aside-method-overloading-and-overriding-rules-in-java">Short aside: method overloading and overriding rules in Java</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#attempt-2-actually-overriding-the-default-equalsobject-o-method">Attempt #2: actually overriding the default equals(Object o) method</a></li>
<li class="toc-entry toc-h3"><a href="#attempt-3-overriding-hashcode-as-well">Attempt #3: overriding hashCode as well</a></li>
<li class="toc-entry toc-h3"><a href="#attempt-4-making-instance-variables-final">Attempt #4: making instance variables final</a></li>
<li class="toc-entry toc-h3"><a href="#attempt-5-using-instanceof-instead-of-getclass">Attempt #5: using instanceof instead of getClass()</a></li>
<li class="toc-entry toc-h3"><a href="#what-if-a-subclass-needs-to-include-additional-state-in-equals">What if a subclass needs to include additional state in equals?</a></li>
<li class="toc-entry toc-h3"><a href="#a-simpler-solution-for-subclasses-that-include-additional-state-in-equals">A simpler solution for subclasses that include additional state in equals</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#how-to-handle-this-in-practice">How to handle this in practice</a></li>
<li class="toc-entry toc-h2"><a href="#testing-your-equals-methods">Testing your equals methods</a></li>
<li class="toc-entry toc-h2"><a href="#resources">Resources</a></li>
</ul><p>If you’ve ever had to write or test an <code class="highlighter-rouge">equals</code> method, you may have gotten a feel for how complex this can get. This post will explain a number of things that can go wrong, offer solutions, and explain how a library called <a href="http://jqno.nl/equalsverifier/">EqualsVerifier</a> can help you prevent unexpected behavior regarding object equality testing.</p>

<h2 id="why-override-the-default-equals-method-anyway">
<a id="why-override-the-default-equals-method-anyway" class="anchor" href="#why-override-the-default-equals-method-anyway" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why override the default <code class="highlighter-rouge">equals</code> method anyway?</h2>

<p>By default, every Java object has an <code class="highlighter-rouge">equals(Object o)</code> method which is inherited from the <code class="highlighter-rouge">Object</code> class. The implementation of this <code class="highlighter-rouge">equals</code> method compares objects using their memory locations, meaning that two objects are only considered equal if they actually point to the exact same memory location and are thus really one and the same object.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="n">object1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">sameObject</span> <span class="o">=</span> <span class="n">object1</span><span class="o">;</span>
    <span class="n">Object</span> <span class="n">object2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>

    <span class="n">assertTrue</span><span class="o">(</span><span class="n">object1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">sameObject</span><span class="o">));</span> <span class="c1">// this succeeds</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">object1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">object2</span><span class="o">));</span> <span class="c1">// this fails</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you want to define equality in such a way that two objects can be considered equal even if they don’t point to the exact same memory location, you will need a custom <code class="highlighter-rouge">equals</code> implementation.</p>

<h2 id="the-requirements-for-a-good-equals-method">
<a id="the-requirements-for-a-good-equals-method" class="anchor" href="#the-requirements-for-a-good-equals-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>The requirements for a good <code class="highlighter-rouge">equals</code> method</h2>

<ul>
  <li>Reflexivity: every object is equal to itself</li>
  <li>Symmetry: if a is equal to b, then b is also equal to a</li>
  <li>Transitivity: if a is equal to b and b is equal to c, then a is also equal to c</li>
  <li>Consistency: if a is equal to b right now, then a is always equal to b as long as none of their state that is used in the <code class="highlighter-rouge">equals</code> method has been modified</li>
  <li>Non-nullity: an actual object is never equal to <code class="highlighter-rouge">null</code>
</li>
</ul>

<h2 id="introducing-the-point-class">
<a id="introducing-the-point-class" class="anchor" href="#introducing-the-point-class" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introducing the <code class="highlighter-rouge">Point</code> class</h2>

<p>The <code class="highlighter-rouge">Point</code> class is the class we will be using as an example throughout this post. It is a simple class representing a point on a two-dimensional grid by means of an x coordinate and a y coordinate.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// getters and setters for x and y here</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We want to consider two <code class="highlighter-rouge">Point</code> objects to be equal if and only if they have the same x coordinate and the same y coordinate. Therefore, we will attempt to write an equals method that accomplishes this.</p>

<h2 id="the-journey-to-a-perfect-equals-method">
<a id="the-journey-to-a-perfect-equals-method" class="anchor" href="#the-journey-to-a-perfect-equals-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>The journey to a “perfect” <code class="highlighter-rouge">equals</code> method</h2>

<h3 id="attempt-1">
<a id="attempt-1" class="anchor" href="#attempt-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attempt #1</h3>

<p>Well, our class is simple, so let’s write a simple <code class="highlighter-rouge">equals</code> method. We add this method to our <code class="highlighter-rouge">Point</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Point</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Seems simple enough. Now, let’s test our <code class="highlighter-rouge">equals</code> method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Point</span> <span class="n">point1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Point</span> <span class="n">point2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">point1</span><span class="o">);</span>
                
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">point1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">point2</span><span class="o">));</span> <span class="c1">// this succeeds</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">points</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">point2</span><span class="o">));</span> <span class="c1">// this fails</span>
<span class="o">}</span>
</code></pre></div></div>

<p>What happened? Even though the <code class="highlighter-rouge">List</code> internally calls <code class="highlighter-rouge">equals</code> to check equality, it somehow doesn’t consider <code class="highlighter-rouge">point1</code> and <code class="highlighter-rouge">point2</code> to be equal.</p>

<p>One important thing to note is that the <code class="highlighter-rouge">contains</code> method takes an <code class="highlighter-rouge">Object</code> as its argument, which means that <code class="highlighter-rouge">point2</code> is passed as an <code class="highlighter-rouge">Object</code>. The following test shows that our current <code class="highlighter-rouge">equals</code> method doesn’t handle this very well.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Point</span> <span class="n">point1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Object</span> <span class="n">pointObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
                
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">point1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">pointObject</span><span class="o">));</span> <span class="c1">// this fails</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">pointObject</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">point1</span><span class="o">));</span> <span class="c1">// also fails</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="short-aside-method-overloading-and-overriding-rules-in-java">
<a id="short-aside-method-overloading-and-overriding-rules-in-java" class="anchor" href="#short-aside-method-overloading-and-overriding-rules-in-java" aria-hidden="true"><span class="octicon octicon-link"></span></a>Short aside: method overloading and overriding rules in Java</h4>

<p>When calling methods, Java determines the exact method to call in a way that can be confusing at first. There are basically two steps:</p>

<ol>
  <li>At compile time, the number and compile-time types of the arguments are used to determine the exact <em>signature</em> of the method that will be invoked.</li>
  <li>At runtime, if the method to be invoked is an instance method, the actual method to invoke will be determined using dynamic method lookup based on the actual run time type of the object and the structure of the inheritance hierarchy.</li>
</ol>

<p>For more info, check the post on <a href="/2018/12/08/Java-overloading-overriding-method-hiding/">Java overloading, overriding and method hiding</a>.</p>

<p>In the code above, we have two classes: <code class="highlighter-rouge">Object</code>, which has a method <code class="highlighter-rouge">equals(Object)</code>, and the class <code class="highlighter-rouge">Point</code>, which has a method <code class="highlighter-rouge">equals(Point)</code> and also inherits the <code class="highlighter-rouge">equals(Object)</code> method from <code class="highlighter-rouge">Object</code>. What happens in the code is the following:</p>

<ul>
  <li>In the first assertion, we are calling a method with signature <code class="highlighter-rouge">equals(Object)</code> on an object with compile-time type <code class="highlighter-rouge">Point</code>. As <code class="highlighter-rouge">Point</code> does not implement a method with that signature, the best match is the <code class="highlighter-rouge">equals(Object)</code> method inherited from <code class="highlighter-rouge">Object</code>.</li>
  <li>In the second assertion, we are calling a method with signature <code class="highlighter-rouge">equals(Point)</code> on an object with compile-time type <code class="highlighter-rouge">Object</code>. As <code class="highlighter-rouge">Object</code> does not have an <code class="highlighter-rouge">equals(Point)</code> method, the best match at compile time is its <code class="highlighter-rouge">equals(Object)</code> method. And, beause <code class="highlighter-rouge">Point</code> (the run-time type of <code class="highlighter-rouge">pointObject</code>) does not override that method, the actual implementation that gets called is still the one defined in <code class="highlighter-rouge">Object</code>.</li>
</ul>

<p>In both cases, <code class="highlighter-rouge">Object</code>’s <code class="highlighter-rouge">equals(Object o)</code> method tells us that <code class="highlighter-rouge">point1</code> and <code class="highlighter-rouge">pointObject</code> are not equal because they do not point to the exact same memory location.</p>

<h3 id="attempt-2-actually-overriding-the-default-equalsobject-o-method">
<a id="attempt-2-actually-overriding-the-default-equalsobject-o-method" class="anchor" href="#attempt-2-actually-overriding-the-default-equalsobject-o-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attempt #2: actually overriding the default <code class="highlighter-rouge">equals(Object o)</code> method</h3>

<p>Ok, so let’s properly override <code class="highlighter-rouge">Object</code>’s <code class="highlighter-rouge">equals(Object)</code> method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="n">Point</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Our tests from the previous attempt will now succeed. However, a new issue arises:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>        
    <span class="n">Point</span> <span class="n">point1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Point</span> <span class="n">point2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;();</span>
    <span class="n">points</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">point1</span><span class="o">);</span>
            
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">points</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">point2</span><span class="o">));</span> <span class="c1">// this fails</span>
<span class="o">}</span>
</code></pre></div></div>
<p>The issue here is that, while we did override the default <code class="highlighter-rouge">equals</code> method, we didn’t override the default <code class="highlighter-rouge">hashCode</code> method as well. When our <code class="highlighter-rouge">HashSet</code> looks for <code class="highlighter-rouge">point2</code>, it only looks in the hash bucket that corresponds to <code class="highlighter-rouge">point2</code>’s hash code. Therefore, if two objects are considered equal, we must guarantee that their hash code will also be the same (<code class="highlighter-rouge">hashcode</code> needs to be consistent with <code class="highlighter-rouge">equals</code>). Note that it is ok for two different objects to have the same hash code, although it is better to avoid this as it can negatively impact the performance of data strucures that rely on hash codes.</p>

<h3 id="attempt-3-overriding-hashcode-as-well">
<a id="attempt-3-overriding-hashcode-as-well" class="anchor" href="#attempt-3-overriding-hashcode-as-well" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attempt #3: overriding <code class="highlighter-rouge">hashCode</code> as well</h3>

<p>Ok, let’s add a <code class="highlighter-rouge">hashCode</code> method that is consistent with our <code class="highlighter-rouge">equals</code> method (this method was actually generated automatically by my IDE):</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">prime</span> <span class="o">=</span> <span class="mi">31</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">prime</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">x</span><span class="o">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">prime</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The previous tests now pass, but we are still not quite there:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>    
    <span class="n">Point</span> <span class="n">point1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;();</span>
    <span class="n">points</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">point1</span><span class="o">);</span>
    
    <span class="n">point1</span><span class="o">.</span><span class="na">setX</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
            
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">points</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">point1</span><span class="o">));</span> <span class="c1">// this fails</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This means that, although <code class="highlighter-rouge">point1</code> is the actual object we put in the set, the set doesn’t seem to contain <code class="highlighter-rouge">point1</code> anymore. When we added <code class="highlighter-rouge">point1</code> to the set, it got assigned to a hash bucket based on its hash code. However, by changing the point’s x coordinate, we have also changed its hash code. The <code class="highlighter-rouge">contains</code> method looks in the bucket corresponding to the new hash code and will not find our point there because it sits in the bucket corresponding to its original hash code.</p>

<h3 id="attempt-4-making-instance-variables-final">
<a id="attempt-4-making-instance-variables-final" class="anchor" href="#attempt-4-making-instance-variables-final" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attempt #4: making instance variables final</h3>

<p>Ok, let’s solve the previous issue by making the x and y coordinate <code class="highlighter-rouge">final</code>. This yields the following definition for our <code class="highlighter-rouge">Point</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// getters for x and y here</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="n">Point</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">prime</span> <span class="o">=</span> <span class="mi">31</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">prime</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">x</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">prime</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>    
<span class="o">}</span>
</code></pre></div></div>

<p>Our current <code class="highlighter-rouge">equals</code> method is functionally equivalent to the one that my IDE generates automatically (using the default settings) and our <code class="highlighter-rouge">hashCode</code> method was already generated by my IDE. Therefore, if I let my IDE do the work for me, this is what I’m going to get by default. But is it enough?</p>

<p>Well, it is enough if we don’t have to care about subclasses. If there are subclasses involved, things get a bit more interesting.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>    
    <span class="n">Point</span> <span class="n">point1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Point</span> <span class="n">point2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{};</span>

    <span class="n">assertTrue</span><span class="o">(</span><span class="n">point1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">point2</span><span class="o">));</span> <span class="c1">// this fails</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In this test, <code class="highlighter-rouge">point2</code> is an instance of an anonymous subclass of <code class="highlighter-rouge">Point</code> that adds no additional behavior or state. Here, <code class="highlighter-rouge">point2</code> has the exact same x and y coordinate as <code class="highlighter-rouge">point1</code> (it actually even has exactly identical state and behavior). However, they are not considered to be equal at all. This violates the contract for our <code class="highlighter-rouge">equals</code> method on <code class="highlighter-rouge">Point</code>, which we defined as “two <code class="highlighter-rouge">Point</code>s are equal if and only if they have the same x coordinate and the same y coordinate”.</p>

<p>The reason why this test fails is that the <code class="highlighter-rouge">equals</code> method uses <code class="highlighter-rouge">getClass()</code> to verify if both objects belong to the same class and <code class="highlighter-rouge">getClass()</code> will actually return a different class for <code class="highlighter-rouge">point1</code> and <code class="highlighter-rouge">point2</code>.</p>

<p>Although you will probably not create a lot of trivial anonymous subclasses in real life, you may sometimes want to subclass a class that you defined a custom <code class="highlighter-rouge">equals</code> method for and allow objects of the subclass to equal objects of the superclass. Fortunately, we can provide this behavior by using <code class="highlighter-rouge">instanceof</code> instead of <code class="highlighter-rouge">getClass()</code>.</p>

<h3 id="attempt-5-using-instanceof-instead-of-getclass">
<a id="attempt-5-using-instanceof-instead-of-getclass" class="anchor" href="#attempt-5-using-instanceof-instead-of-getclass" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attempt #5: using <code class="highlighter-rouge">instanceof</code> instead of <code class="highlighter-rouge">getClass()</code>
</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Point</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="n">Point</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This implementation’s behavior is equivalent to that of the implementation generated by my IDE if I choose the option to use <code class="highlighter-rouge">instanceof</code> instead of <code class="highlighter-rouge">getClass()</code>. It passes all of our previous tests. In fact, as long as no subclass of <code class="highlighter-rouge">Point</code> ever overrides our <code class="highlighter-rouge">equals</code> (or <code class="highlighter-rouge">hashCode</code>) method, this will work just fine. This means that, when letting my IDE generate my <code class="highlighter-rouge">equals</code> and <code class="highlighter-rouge">hashCode</code> methods for me, I actually get a good implementation as long as I choose the right options.</p>

<p>One additional thing that the version generated by my IDE does is that it starts by checking for actual identity. This is a very inexpensive test, making this a good optimization if it is common for equal objects to also be identical.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Point</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="n">Point</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="what-if-a-subclass-needs-to-include-additional-state-in-equals">
<a id="what-if-a-subclass-needs-to-include-additional-state-in-equals" class="anchor" href="#what-if-a-subclass-needs-to-include-additional-state-in-equals" aria-hidden="true"><span class="octicon octicon-link"></span></a>What if a subclass needs to include additional state in <code class="highlighter-rouge">equals</code>?</h3>

<p>Things get more complicated if a subclass is going to add state and we want to include this state in its <code class="highlighter-rouge">equals</code> method. For example, let’s assume that we have an enum called <code class="highlighter-rouge">Color</code> and we create a class <code class="highlighter-rouge">ColorPoint</code> that extends the <code class="highlighter-rouge">Point</code> class with a specific color for a point.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Color</span> <span class="o">{</span>
    <span class="n">BLUE</span><span class="o">,</span> <span class="n">RED</span><span class="o">,</span> <span class="n">YELLOW</span><span class="o">,</span> <span class="n">GREEN</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ColorPoint</span> <span class="kd">extends</span> <span class="n">Point</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ColorPoint</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">,</span> <span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="c1">// getter for color</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now, what if we want to include the color in the <code class="highlighter-rouge">equals</code> method so that a <code class="highlighter-rouge">ColorPoint(1, 1, Color.RED)</code> is not equal to a <code class="highlighter-rouge">ColorPoint(1, 1, Color.BLUE)</code>? Well, there is a way to accomplish this. It is also described in <a href="http://www.artima.com/lejava/articles/equality.html">this article</a>.</p>

<p>An important remark is that, in this solution, a <code class="highlighter-rouge">Point</code> will never be able to be equal to a <code class="highlighter-rouge">ColorPoint</code>. The reason for this is that we need our <code class="highlighter-rouge">equals</code> method to be transitive. If we would follow the contract we envisioned for the <code class="highlighter-rouge">equals</code> method of <code class="highlighter-rouge">Point</code> (two <code class="highlighter-rouge">Point</code>s are equal if and only if they have the same x coordinate and the same y coordinate), this would mean that a <code class="highlighter-rouge">Point(1, 1)</code> is equal to a <code class="highlighter-rouge">ColorPoint(1, 1, Color.RED)</code> and to a <code class="highlighter-rouge">ColorPoint(1, 1, Color.BLUE)</code>. However, transitivity would then imply that a <code class="highlighter-rouge">ColorPoint(1, 1, Color.RED)</code> and a <code class="highlighter-rouge">ColorPoint(1, 1, Color.BLUE)</code> must be equal to each other, which is exactly what we didn’t want.</p>

<p>Because of this, this solution could cause unexpected behavior in code that depends on the contract that “two <code class="highlighter-rouge">Point</code>s are equal if and only if they have the same x coordinate and the same y coordinate”.</p>

<p>The solution involves introducing a <code class="highlighter-rouge">canEqual</code> method and letting custom <code class="highlighter-rouge">equals</code> methods call that method on the <em>other</em> object.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Point</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="n">Point</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        
        <span class="k">if</span> <span class="o">(!</span><span class="n">other</span><span class="o">.</span><span class="na">canEqual</span><span class="o">(</span><span class="k">this</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canEqual</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Point</span><span class="o">);</span>
    <span class="o">}</span>    
    
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ColorPoint</span> <span class="kd">extends</span> <span class="n">Point</span> <span class="o">{</span>
    <span class="c1">// ...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">ColorPoint</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="n">ColorPoint</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">ColorPoint</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        
        <span class="k">if</span> <span class="o">(!</span><span class="n">other</span><span class="o">.</span><span class="na">canEqual</span><span class="o">(</span><span class="k">this</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">color</span> 
                <span class="o">&amp;&amp;</span> <span class="kd">super</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">other</span><span class="o">));</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canEqual</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">ColorPoint</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Point</code> and <code class="highlighter-rouge">ColorPoint</code> classes both satisfy all of the previous tests. If we would create a new subclass of <code class="highlighter-rouge">Point</code> or <code class="highlighter-rouge">ColorPoint</code> without overriding <code class="highlighter-rouge">equals</code>, <code class="highlighter-rouge">canEqual</code> or <code class="highlighter-rouge">hashCode</code>, instances oft the subclass can still be equal to instances of the superclass. If we want to create a new subclass of <code class="highlighter-rouge">Point</code> or <code class="highlighter-rouge">ColorPoint</code> that adds additional state and includes this state in its <code class="highlighter-rouge">equals</code> method, we need to override both <code class="highlighter-rouge">equals</code> and <code class="highlighter-rouge">canEqual</code>.</p>

<p>As stated before, the only big drawback of this approach is the fact that it breaks our original contract saying that “two <code class="highlighter-rouge">Point</code>s are equal if and only if they have the same x coordinate and the same y coordinate”. A piece of code operating on <code class="highlighter-rouge">Point</code> instances can not longer make the assumption that, if two <code class="highlighter-rouge">Point</code>s are not equal to each other, there must be some difference in their x or y coordinates. Indeed, this assumption no longer holds if some of the instances are <code class="highlighter-rouge">ColorPoint</code> instances. This is essentially a violation of the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle</a>, although the article linked above doesn’t seem to agree.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Point</span> <span class="n">point1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">Point</span> <span class="n">point2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ColorPoint</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">Color</span><span class="o">.</span><span class="na">BLUE</span><span class="o">);</span>
            
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">point1</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">==</span> <span class="n">point2</span><span class="o">.</span><span class="na">getX</span><span class="o">());</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">point1</span><span class="o">.</span><span class="na">getY</span><span class="o">()</span> <span class="o">==</span> <span class="n">point2</span><span class="o">.</span><span class="na">getY</span><span class="o">());</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">point1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">point2</span><span class="o">));</span> <span class="c1">// this fails</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="a-simpler-solution-for-subclasses-that-include-additional-state-in-equals">
<a id="a-simpler-solution-for-subclasses-that-include-additional-state-in-equals" class="anchor" href="#a-simpler-solution-for-subclasses-that-include-additional-state-in-equals" aria-hidden="true"><span class="octicon octicon-link"></span></a>A simpler solution for subclasses that include additional state in <code class="highlighter-rouge">equals</code>
</h3>

<p>The previous approach is relatively complex, mostly because we wanted to allow subclass objects to be equal to superclass objects as long as they don’t need to include additional state in their equals method.</p>

<p>If we’re okay with subclass objects never being equal to superclass objects, we can just go ahead and use the <code class="highlighter-rouge">getClass()</code> approach.</p>

<h2 id="how-to-handle-this-in-practice">
<a id="how-to-handle-this-in-practice" class="anchor" href="#how-to-handle-this-in-practice" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to handle this in practice</h2>

<p>In practice, the approach that you’ll typically want to follow is this:</p>

<ol>
  <li>Let your IDE generate your <code class="highlighter-rouge">equals</code> (and <code class="highlighter-rouge">hashCode</code>) methods for you, using <code class="highlighter-rouge">instanceof</code> instead of <code class="highlighter-rouge">getClass()</code>.</li>
  <li>Either make your class <code class="highlighter-rouge">final</code> or make your <code class="highlighter-rouge">equals</code> and <code class="highlighter-rouge">hashCode</code> methods <code class="highlighter-rouge">final</code>.</li>
</ol>

<p>Note that the two options outlined in step 2 have different effects:</p>

<ul>
  <li>Making your class <code class="highlighter-rouge">final</code> prevents any issues with subclasses by simply not allowing subclasses for your class.</li>
  <li>Making your <code class="highlighter-rouge">equals</code> and <code class="highlighter-rouge">hashCode</code> methods <code class="highlighter-rouge">final</code> prevents subclasses from overriding your <code class="highlighter-rouge">equals</code> and <code class="highlighter-rouge">hashCode</code> methods and including additional state in them.</li>
</ul>

<p>In cases where this is not sufficient (you want subclasses to include additional state in their <code class="highlighter-rouge">equals</code> method), consider using the solution involving the <code class="highlighter-rouge">canEqual</code> method or the simpler solution if you’re ok with subclass instances never being equal to superclass instances.</p>

<h2 id="testing-your-equals-methods">
<a id="testing-your-equals-methods" class="anchor" href="#testing-your-equals-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing your <code class="highlighter-rouge">equals</code> methods</h2>

<p>Testing an <code class="highlighter-rouge">equals</code> method by hand is a tedious task that will likely lead to pages and pages of error-prone testing code. Fortunately, there is a better solution: the <a href="http://jqno.nl/equalsverifier/">EqualsVerifier</a> library by Jan Ouwens. Using it is simple:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">equalsContract</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">EqualsVerifier</span><span class="o">.</span><span class="na">forClass</span><span class="o">(</span><span class="n">Point</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">verify</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>It uses reflection to inspect your class and test its <code class="highlighter-rouge">equals</code> and <code class="highlighter-rouge">hashCode</code> methods with 100% coverage. It recognizes all of the possible issues that were outlined in this article (and some others as well). If you’re confused by an error message it produces, have a look at <a href="http://jqno.nl/equalsverifier/errormessages/">this overview</a>. If you understand why EqualsVerifier complains about a certain issue but you need it to be less restrictive, you can pass it an additional option to make it ignore that issue. This library should be able to make hand-written <code class="highlighter-rouge">equals</code> tests a thing of the past.</p>

<h2 id="resources">
<a id="resources" class="anchor" href="#resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resources</h2>

<ul>
  <li><a href="http://jqno.nl/equalsverifier/">EqualsVerifier</a></li>
  <li><a href="http://www.artima.com/lejava/articles/equality.html">How to Write an Equality Method in Java</a></li>
  <li>Core Java SE 9 for the Impatient (book by Cay S. Horstmann)</li>
  <li><a href="https://docs.oracle.com/javase/specs/jls/se10/html/jls-8.html#jls-8.4.9">Overloading in the Java Language Specification</a></li>
</ul>

    </div>

    
</article>

		</div>
		
		<div class="sticky-footer-push"></div>
	</div>

    <div class="wrapper-footer sticky-footer-footer">
      <div class="container">
        <footer class="footer">
          



<a href="https://github.com/convincedcoder/convincedcoder.github.io-source"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/convincedcoder"><i class="svg-icon twitter"></i></a>



        </footer>
      </div>
    </div>

		
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-130247825-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/2018/01/21/Writing-an-equals-method/',
		  'title': 'Writing an equals method - how hard can it be?'
		});
	</script>
	<!-- End Google Analytics -->


		
		<script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 50,
  backgroundColor: '#2f2f2f',
  textColor: '#fff'
})</script> 
  </body>
</html>
